# J-Quants API 設定ガイド

## 1. J-Quantsアカウント作成

1. [J-Quants公式サイト](https://jpx-jquants.com/) にアクセス
2. 「新規登録」でアカウント作成
3. メール認証を完了
4. 無料プランでも利用可能（1日1,000リクエスト）

## 2. 認証フロー

J-Quants APIは2段階認証を使用：
1. **リフレッシュトークン取得**: メールアドレス + パスワード
2. **アクセストークン取得**: リフレッシュトークンを使用

## 3. 環境変数設定

### ローカル開発
`.env.local` ファイルに認証情報を設定：
```
JQUANTS_EMAIL=your_email@example.com
JQUANTS_PASSWORD=your_password
```

### Vercelデプロイ
1. Vercelダッシュボードで該当プロジェクトを選択
2. Settings → Environment Variables
3. 以下の環境変数を追加：
   - `JQUANTS_EMAIL`: J-Quantsアカウントのメールアドレス
   - `JQUANTS_PASSWORD`: J-Quantsアカウントのパスワード

## 4. 利用可能な銘柄コード

J-Quantsでは以下の形式で銘柄コードを指定：
- トヨタ自動車: `7203`
- ソフトバンクグループ: `9984`
- 任天堂: `7974`
- ソニー: `6758`

## 5. API制限と注意事項

- **無料プラン**: 1日1,000リクエスト
- **有料プラン**: より多くのリクエストと詳細データ
- **レート制限**: 1秒間に複数リクエストは避ける
- **キャッシュ**: アプリ内で6時間キャッシュして制限を節約

## 6. フォールバック機能

APIキーが未設定またはエラーの場合：
- 自動的にモックデータにフォールバック
- エラーログを出力
- サービス継続可能

## 7. 取得可能データ

### 株価データ
- 日次株価（始値、高値、安値、終値、出来高）
- 調整後株価（株式分割等に対応）
- 過去30日分のデータ

### 企業情報
- 銘柄名
- 業種分類
- 市場区分

### 財務データ（有料プランで詳細利用可能）
- PER, PBR, ROE
- 配当利回り
- 時価総額
- 売上高

## 8. トラブルシューティング

### よくあるエラー
1. **401 Unauthorized**: APIキーが間違っている
2. **403 Forbidden**: APIクォータ超過
3. **404 Not Found**: 存在しない銘柄コード
4. **429 Too Many Requests**: レート制限に引っかかった

### 対処法
- APIキーを確認
- 銘柄コードの形式確認（4桁数字）
- リクエスト頻度を調整
- キャッシュの活用